(self.webpackChunkEVA_libre=self.webpackChunkEVA_libre||[]).push([[594],{39161:(e,t,o)=>{"use strict";o.d(t,{A:()=>s});var i=o(38685);const s=class{constructor(e,t,o){this.animationManager=e,this.apiKey=t,this.region=o,this.queue=[],this.isSpeaking=!1,this.player,this.audioConfig,this.audioInterrupt=!1,this.initSynthesizer()}initSynthesizer(){const e=this.apiKey,t=this.region,o=i.SpeechConfig.fromSubscription(e,t);o.speechSynthesisVoiceName="en-US-JennyNeural";const s=new i.SpeakerAudioDestination,n=i.AudioConfig.fromSpeakerOutput(s);this.player=s,this.audioConfig=n,this.synthesizer=new i.SpeechSynthesizer(o,this.audioConfig),this.synthesizer.visemeReceived=(e,t)=>{this.scheduleVisemeApplication(t.visemeId,t.audioOffset)}}enqueueText(e){this.queue.push(e),this.isSpeaking||this.processQueue()}processQueue(){if(0===this.queue.length)return void(this.isSpeaking=!1);this.isSpeaking=!0;const e=this.queue.shift();this.synthesizeSpeech(e).then((()=>this.processQueue()))}synthesizeSpeech(e){return new Promise(((t,o)=>{this.synthesizer.speakTextAsync(e,(e=>{console.log("Speech synthesis completed."),t(e)}),(e=>{console.log("Error during speech synthesis, restarting"),o(e)}))}))}scheduleVisemeApplication(e,t){setTimeout((()=>{this.applyVisemeToCharacter(e)}),t/1e4)}applyVisemeToCharacter(e){const t=this.animationManager.facsLib;this.audioInterrupt?(this.animationManager.setFaceToNeutral(),t.setNeutralViseme()):0===e?t.setNeutralViseme(0):(e-=1,t.setTargetViseme(e,70,0)),t.updateEngine()}stopSpeech(){this.synthesizer.close(),this.queue=[],this.isSpeaking=!1,this.initSynthesizer(),console.log("Speech synthesis stopped.")}interruptSpeech(e){this.synthesizer.close(),this.queue=[],this.isSpeaking=!1,this.initSynthesizer(),e&&this.enqueueText(e),console.log("Speech synthesis interrupted.")}}},67333:(e,t,o)=>{"use strict";o.d(t,{A:()=>i});const i=class{constructor(e){if(!e||"string"!==typeof e)throw new Error("A valid OpenAI API key must be provided.");this.apiKey=e,this.apiUrl="https://api.openai.com/v1/chat/completions"}async processText(e){const t={model:"gpt-3.5-turbo",messages:[{role:"system",content:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Answer in a professional manner:"},{role:"user",content:e}],max_tokens:150,temperature:.7};try{var o,i,s,n;const e=await fetch(this.apiUrl,{method:"POST",headers:{Authorization:"Bearer ".concat(this.apiKey),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("API request failed with status: ".concat(e.status));const a=null===(o=(await e.json()).choices)||void 0===o||null===(i=o[0])||void 0===i||null===(s=i.message)||void 0===s||null===(n=s.content)||void 0===n?void 0:n.trim();if(!a)throw new Error("Failed to get a valid response from the API");return a}catch(a){throw console.error("Error processing text with GPT:",a),a}}}},93345:(e,t,o)=>{"use strict";o.r(t),o.d(t,{start:()=>w,stop:()=>k});var i=o(39161),s=o(67333);let n,a,r,c,l=!1,p="",u=!1,h=!1;function g(e){e.forEach((e=>{let{id:t,intensity:o,duration:i,explanation:s=""}=e;animationManager.scheduleChange(t,90*o,i,0,s)}))}function y(){let e=[{id:"6",intensity:.4,duration:750,explanation:""},{id:"12",intensity:.5,duration:750,explanation:""}];g(e)}function d(){animationManager.setFaceToNeutral()}function m(e){return new Promise((t=>setTimeout(t,e)))}async function f(e){r.initSynthesizer();let t=await r.synthesizeSpeech(e);console.log("synthesize_result object:",t),console.log("synthesize result transcript:",e),console.log("synthesize result audioDuration:",t.audioDuration),console.log("before delay!");try{await m(t.audioDuration/1e4),console.log("after delay!")}catch(o){"Delay aborted"===o.message?console.log("Delay was aborted"):console.error("Error during delay:",o)}}async function w(e,t){if(console.log("Calling start!"),console.log("openai key object:",t.openai_api_key),console.log("azure key object:",t.azure_api_key),console.log("openai key object type:",typeof t.openai_api_key),console.log("azure key object type:",typeof t.azure_api_key),console.log("openai key default:",t.openai_api_key.default),console.log("azure key default:",t.azure_api_key.default),c=1,r=t.azure_api_key&&"string"==typeof t.azure_api_key?new i.A(e,t.azure_api_key,"eastus"):new i.A(e,t.azure_api_key.default,"eastus"),y(),await f("Hello, my name is eva. I am powered by ChatGPT. I am programmed to provide a response to ".concat(t.num_prompts," questions. Feel free to ask away!")),d(),console.log("recognitionStop:",h),"webkitSpeechRecognition"in window){console.log("SpeechRecognition available!"),u=!1;let e={};if(!h){l=!0,h=!1;const o=window.SpeechRecognition||window.webkitSpeechRecognition;n=new o,a=t.openai_api_key&&"string"==typeof t.openai_api_key?new s.A(t.openai_api_key):new s.A(t.openai_api_key.default),n.continuous=!0,n.lang="en-US",n.interimResults=!0,n.maxAlternatives=1,n.onresult=async function(o){let i="",s=!1,r={};for(let e=o.resultIndex;e<o.results.length;e++)i+=o.results[e][0].transcript,o.results[e].isFinal&&(s=!0);if(console.log("processingRequest:",u),s&&i!==p&&!u){p=i,u=!0;let o=i.toLowerCase().trim();if(console.log("Recognized Speech:",o),o){console.log("openai key:",t.openai_api_key),console.log("azure key:",t.azure_api_key),r.user_prompt=o;let i="";if(i=await async function(e,t){let o="";try{o=await t.processText(e),console.log("gptResponse: ",o)}catch(i){console.error("Error processing GPT response:",i)}try{return o&&(await f(o),c+=1),o}catch(i){console.error("Error processing TTS response:",i)}}(o,a),r.agent_response=i,console.log("finished request!"),console.log("numTransactions:",c),console.log("settings.num_prompts:",t.num_prompts),e[c-1]=r,u=!1,console.log("processingRequest:",u),c>t.num_prompts){u=!0,await f("It appears I've answered my ".concat(t.num_prompts," questions.")),await f("If you'd like to review this conversation, a transcript is available in the inspector."),await f("Talk to you later!"),y(),g([{id:"46L",intensity:.9,duration:300,explanation:""}]),await m(1e3),d();let o=JSON.stringify(e,null,2);console.log("Transaction History:\n".concat(o)),h=!0,n.stop()}}}},n.onend=function(){h||(console.log("Speech recognition restarting..."),l&&(n.start(),console.log("Speech recognition restarted!")))}}}else console.error("SpeechRecognition not available in this browser!");1==l&&(n.start(),console.log("speech recognition started!"))}function k(){console.log("Calling stop!"),h=!0,console.log("recognitionStop:",h),l&&(n.stop(),console.log("speech recognition stopped!")),console.log("Reached end stop!")}},26308:()=>{},42250:()=>{},29645:()=>{},88632:()=>{},13678:()=>{},44573:()=>{},10952:()=>{}}]);
//# sourceMappingURL=594.c87c45d4.chunk.js.map