(self.webpackChunkEVA_libre=self.webpackChunkEVA_libre||[]).push([[394],{80019:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(65043),o=r(13531),s=r(70579);const a=e=>{let{onEmotionDetected:t,stopVideoRef:r}=e;const a=(0,n.useRef)(),c=(0,n.useRef)(),i=(0,n.useRef)(),l=(0,n.useRef)();(0,n.useEffect)((()=>{(async()=>{try{const e="/EVA-libre/models";await o.B0.tinyFaceDetector.loadFromUri(e),await o.B0.faceLandmark68Net.loadFromUri(e),await o.B0.faceRecognitionNet.loadFromUri(e),await o.B0.faceExpressionNet.loadFromUri(e),u()}catch(e){console.error("Error loading models:",e)}})()}),[]);const u=()=>{navigator.mediaDevices.getUserMedia({video:{}}).then((e=>{l.current=e,a.current.srcObject=e})).catch((e=>console.error("Error accessing webcam:",e)))},d=()=>{l.current&&l.current.getTracks().forEach((e=>e.stop()))},f=async()=>{if(!a.current||a.current.paused||a.current.ended)return;const e=await o.R(a.current,new o.ex).withFaceLandmarks().withFaceExpressions(),r=c.current;if(!r)return void console.error("Canvas is not available");const n={width:a.current.videoWidth,height:a.current.videoHeight};o.L0(r,n);const s=o.Lz(e,n);if(r.getContext("2d").clearRect(0,0,r.width,r.height),o.$2.drawDetections(r,s),o.$2.drawFaceLandmarks(r,s),o.$2.drawFaceExpressions(r,s),e.length>0){const r=e[0].expressions,n=Object.entries(r).map((e=>{let[t,r]=e;return[t,r,Date.now()]})).sort(((e,t)=>t[1]-e[1]));t&&t(n)}};return(0,n.useEffect)((()=>{const e=()=>{i.current||(i.current=setInterval(f,100))},t=a.current;return null===t||void 0===t||t.addEventListener("play",e),r&&(r.current=d),()=>{clearInterval(i.current),i.current=null,null===t||void 0===t||t.removeEventListener("play",e)}}),[]),(0,s.jsxs)("div",{style:{position:"relative"},children:[(0,s.jsx)("video",{ref:a,autoPlay:!0,muted:!0,width:"480",height:"270",style:{position:"relative"}}),(0,s.jsx)("canvas",{ref:c,style:{position:"absolute",left:0,top:0}})]})}},77419:(e,t,r)=>{"use strict";r.r(t),r.d(t,{start:()=>l,stop:()=>u});var n=r(84391),o=r(65043),s=r(80019),a=r(70579);let c=null,i=null;const l=(e,t,r)=>{if(!r||!r.current)return void console.error("Container reference not provided or invalid. Unable to start FaceDetectionApp.");c||(c=n.createRoot(r.current));i=o.createRef(),c.render((0,a.jsx)(s.A,{animationManager:e,settings:t,onEmotionDetected:e=>{console.log("Detected sortedEmotionsTuples:",e);let t=e[0];console.log("Top Emotion Tuple:",t)},stopVideoRef:i}))},u=()=>{i&&i.current&&i.current(),c&&(c.unmount(),c=null)}},41591:()=>{},82766:()=>{},61065:()=>{},3886:()=>{}}]);
//# sourceMappingURL=394.5bea5201.chunk.js.map