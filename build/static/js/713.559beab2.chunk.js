(self.webpackChunkEVA_libre=self.webpackChunkEVA_libre||[]).push([[713],{39161:(e,o,t)=>{"use strict";t.d(o,{A:()=>i});var n=t(38685);const i=class{constructor(e,o,t){this.animationManager=e,this.apiKey=o,this.region=t,this.queue=[],this.isSpeaking=!1,this.audioInterrupt=!1,this.speechConfig=n.SpeechConfig.fromSubscription(this.apiKey,this.region),this.initSynthesizer()}recognizeSpeechUntilSilence(){return new Promise(((e,o)=>{const t=n.AudioConfig.fromDefaultMicrophoneInput(),i=new n.SpeechRecognizer(this.speechConfig,t);let s="",r=null;let a=null;r=setTimeout((()=>{console.log("Silence detected (before recognition), stopping recognition..."),i.stopContinuousRecognitionAsync((()=>{e({text:s.trim(),timestamp:a})}))}),3e3),i.recognizing=(o,t)=>{console.log("Recognizing event triggered"),console.log("Partial result: ".concat(t.result.text)),clearTimeout(r),r=setTimeout((()=>{console.log("Silence detected during recognition, stopping..."),i.stopContinuousRecognitionAsync((()=>{e({text:s.trim(),timestamp:a})}))}),3e3)},i.recognized=(e,o)=>{console.log("Recognized event triggered"),o.result.reason===n.ResultReason.RecognizedSpeech?(console.log("Final result: ".concat(o.result.text)),s+=o.result.text+" ",a=Date.now()):o.result.reason===n.ResultReason.NoMatch&&console.log("No match found.")},i.canceled=(e,t)=>{console.error("Canceled event triggered"),console.error("Recognition canceled: ".concat(t.reason)),i.stopContinuousRecognitionAsync((()=>{o(new Error("Recognition canceled: ".concat(t.reason)))}))},i.sessionStopped=(o,t)=>{console.log("Session stopped due to silence"),i.stopContinuousRecognitionAsync((()=>{e({text:s.trim(),timestamp:a})}))},console.log("Starting continuous recognition..."),i.startContinuousRecognitionAsync((()=>console.log("Recognition started successfully")),(e=>{console.error("Error starting recognition:",e),o(e)}))}))}initSynthesizer(){this.speechConfig.speechSynthesisVoiceName="en-US-JennyNeural";const e=new n.SpeakerAudioDestination,o=n.AudioConfig.fromSpeakerOutput(e);this.synthesizer=new n.SpeechSynthesizer(this.speechConfig,o),this.synthesizer.visemeReceived=(e,o)=>{this.scheduleVisemeApplication(o.visemeId,o.audioOffset)}}enqueueText(e){this.queue.push(e),this.isSpeaking||this.processQueue()}processQueue(){if(0===this.queue.length)return void(this.isSpeaking=!1);this.isSpeaking=!0;const e=this.queue.shift();this.synthesizeSpeech(e).then((()=>this.processQueue()))}synthesizeSpeech(e){return new Promise(((o,t)=>{this.synthesizer.speakTextAsync(e,(e=>{console.log("Speech synthesis completed."),o(e)}),(e=>{console.log("Error during speech synthesis, restarting"),t(e)}))}))}scheduleVisemeApplication(e,o){setTimeout((()=>{this.applyVisemeToCharacter(e)}),o/1e4)}applyVisemeToCharacter(e){const o=this.animationManager.facsLib;this.audioInterrupt?(this.animationManager.setFaceToNeutral(),o.setNeutralViseme()):0===e?o.setNeutralViseme(0):(e-=1,o.setTargetViseme(e,70,0)),o.updateEngine()}stopSpeech(){this.synthesizer.close(),this.queue=[],this.isSpeaking=!1,this.initSynthesizer(),console.log("Speech synthesis stopped.")}interruptSpeech(e){this.synthesizer.close(),this.queue=[],this.isSpeaking=!1,this.initSynthesizer(),e&&this.enqueueText(e),console.log("Speech synthesis interrupted.")}}},67333:(e,o,t)=>{"use strict";t.d(o,{A:()=>n});const n=class{constructor(e){if(!e||"string"!==typeof e)throw new Error("A valid OpenAI API key must be provided.");this.apiKey=e,this.apiUrl="https://api.openai.com/v1/chat/completions"}async processText(e){const o={model:"gpt-3.5-turbo",messages:[{role:"system",content:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Answer in a professional manner:"},{role:"user",content:e}],max_tokens:150,temperature:.7};try{var t,n,i,s;const e=await fetch(this.apiUrl,{method:"POST",headers:{Authorization:"Bearer ".concat(this.apiKey),"Content-Type":"application/json"},body:JSON.stringify(o)});if(!e.ok)throw new Error("API request failed with status: ".concat(e.status));const r=null===(t=(await e.json()).choices)||void 0===t||null===(n=t[0])||void 0===n||null===(i=n.message)||void 0===i||null===(s=i.content)||void 0===s?void 0:s.trim();if(!r)throw new Error("Failed to get a valid response from the API");return r}catch(r){throw console.error("Error processing text with GPT:",r),r}}}},41226:(e,o,t)=>{"use strict";t.r(o),t.d(o,{start:()=>S,stop:()=>k});var n=t(39161),i=t(67333);let s,r,a,c,l=!1,u="",p=!1,g=!1;function h(e){e.forEach((e=>{let{id:o,intensity:t,duration:n,explanation:i=""}=e;animationManager.scheduleChange(o,90*t,n,0,i)}))}function d(){let e=[{id:"6",intensity:.4,duration:750,explanation:""},{id:"12",intensity:.5,duration:750,explanation:""}];h(e)}function y(){animationManager.setFaceToNeutral()}function m(e){return new Promise((o=>setTimeout(o,e)))}async function f(e){a.initSynthesizer();let o=await a.synthesizeSpeech(e);console.log("synthesize_result object:",o),console.log("synthesize result transcript:",e),console.log("synthesize result audioDuration:",o.audioDuration),console.log("before delay!");try{return await m(o.audioDuration/1e4),console.log("after delay!"),e}catch(t){"Delay aborted"===t.message?console.log("Delay was aborted"):console.error("Error during delay:",t)}}async function w(e,o){let t="";try{t=await o.processText(e),console.log("gptResponse: ",t)}catch(n){console.error("Error processing GPT response:",n)}try{return t&&(await f(t),c+=1),t}catch(n){console.error("Error processing TTS response:",n)}}async function S(e,o){g=!1,a=o.azure_api_key&&"string"==typeof o.azure_api_key?new n.A(e,o.azure_api_key,"eastus"):new n.A(e,o.azure_api_key.default,"eastus"),r=o.openai_api_key&&"string"==typeof o.openai_api_key?new i.A(o.openai_api_key):new i.A(o.openai_api_key.default);let t={1:"Do you like attending FIU?",2:"Where are you originally from?",3:"Do you like living in South Florida?",4:"Where would you like to go for you next vacation?",5:"Do you enjoy speaking with me?",6:"Would you speak with me again?"};console.log("questions: ".concat(t));let c=Object.keys(t).length;d(),await f("Hello, my name is eva. I will ask you ".concat(c," questions. Feel free to answer as you feel appropriate!")),y();let S={};for(let n=1;n<=c;n++){console.log("current question: ".concat(n));let e={},o=await f(t[n]);e.agent_question=o,console.log("agent_question:",o);let i=await new Promise((e=>{if("webkitSpeechRecognition"in window){if(console.log("SpeechRecognition available!"),p=!1,console.log("recognitionStop:",g),!g){l=!0,g=!1;const o=window.SpeechRecognition||window.webkitSpeechRecognition;let t;s=new o,s.continuous=!1,s.lang="en-US",s.interimResults=!0,s.maxAlternatives=1,s.onresult=async function(o){let n="",i=!1;for(let e=o.resultIndex;e<o.results.length;e++)n+=o.results[e][0].transcript,o.results[e].isFinal&&(i=!0);if(console.log("processingRequest:",p),i&&n!==u&&!p){u=n,p=!0;let o=n.toLowerCase().trim();console.log("Recognized Speech:",o),clearTimeout(t),s.stop(),p=!1,e(n)}else clearTimeout(t),t=setTimeout((()=>{console.log("No speech detected, stopping recognition."),s.stop(),e(n)}),2e3)},s.onend=()=>{console.log("Speech recognition ended."),e(u)},s.onerror=o=>{console.error("Speech recognition error:",o.error),clearTimeout(t),e(u)}}}else console.error("SpeechRecognition not available in this browser!"),e();l&&(s.start(),console.log("Speech recognition started!"))}));e.user_response=i,console.log("user_response:",i);let a="You are a helpful agent providing simple one sentence responses to user replies to your questions. Do not ask follow-up questions.\nAgent Questions: ".concat(o,"\nUser Response:").concat(i),c=await w(a,r);e.agent_response=c,console.log("agent_response:",c),S[n]=e}await f("It appears I've asked all my questions."),await f("If you'd like to review this conversation, a transcript is available in the inspector."),await f("Thanks for answering all my questions!"),d(),h([{id:"46L",intensity:.9,duration:300,explanation:""}]),await m(1e3),y();let k=JSON.stringify(S,null,2);console.log("Transaction History:\n".concat(k))}function k(){console.log("Calling stop!"),g=!0,console.log("recognitionStop:",g),l&&(s.stop(),console.log("speech recognition stopped!")),console.log("Reached end stop!")}},26308:()=>{},42250:()=>{},29645:()=>{},88632:()=>{},13678:()=>{},44573:()=>{},10952:()=>{}}]);
//# sourceMappingURL=713.559beab2.chunk.js.map